<!DOCTYPE html5>
<html>
    <head>
        <title>Chat</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script src="//code.jquery.com/jquery-1.11.1.js"></script>
    </head>
    <body>
        <center>
            <div>
                <button class="btn btn-info" type="button">채팅방</button>
            </div>
            <div>
                <textarea id="chatLog" class="form-control" readonly='' rows="20"></textarea>
            </div>
            <form id="chat">
                <input id="name" class="form-control" type="text">
                <input id="message" class="form-control" type="text">
                <button class="btn btn-primary" type="submit">전송</button>
            </form>
            <div id="box" class="box"></div>
        </center>
        <script>
            function newChat(msg) {
                $('#chatLog').append(msg + "\n");
                $('#chatLog').scrollTop($('#chatLog')[0].scrollHeight);
            }

            var socket = io.connect('http://localhost:3000');

            $('#chat').on('submit', (event) => {
                socket.emit('chat', { 'name' : $('#name').val(), 'msg' : $('#message').val() });
                $('#message').val('');
                $('#message').focus();
                event.preventDefault();
            });

            socket.on('username', (data) => {
                $('#name').val(data);
                socket.emit('login', data);
            });

            socket.on('new user', (data) => {
                newChat(`${data} 님이 참가하였습니다.`);
            });

            socket.on('user exit', (data) => {
                newChat(`${data} 님이 나가셨습니다.`);
            });

            socket.on('receive chat', (data) => {
                newChat(data);
            });
        </script>
    </body>
</html>